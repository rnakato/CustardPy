# Custardpy

Hi-C analysis tools by Python3 and Docker

## QC
### distance_vs_count.Juicer
Count genomic distance of read pairs in the input file (supposing align/merged_nodups.txt.gz in Juicer output.)

Usage:

      distance_vs_count.Juicer <file> <winsize> <MAPQ>
            <file>:    Input file  (merged_nodups.txt.gz)
            <winsize>: window size (default: 10000)
            <MAPQ>:    MAPQ threshold (default: 30)

## Data generation
### convert_JuicerDump_to_dense.py
Convert interaction frequency file dumped by Juicer to dense matrix

Usage:

    convert_JuicerDump_to_dense.py <inputfile> <outputfile> <genometable> <chr> <resolution> [--help]

Example:

    convert_JuicerDump_to_dense.py \
        Matrix.observed.VC_SQRT.chrX.txt \
        Matrix.observed.VC_SQRT.chrX.matrix.gz \
        genome_table.txt \
        chrX \
        25000


### makeMatrix_intra.sh
Generate dense matrix from .hic for each chromosome

Usage:

     makeMatrix_intra.sh <normalize type (e.g. KR)> <output directory> <.hic> <resolution> <build (r.g., hg38)>

### makeEigen.sh
Generate eigenvector file in that +- of the value is adjusted by the number of genes

Usage:

     makeEigen.sh <normalize type (e.g. KR)> <output directory> <.hic> <resolution> <build (r.g., hg38)>

### makeInslationScore.sh
Calculate insulation score file from dense matrix data

Usage:

     makeInslationScore.sh <normalize type (e.g. KR)> <output directory> <resolution> <build (r.g., hg38)>

## Visualization
### plotHiCMatrix.py
Plot Hi-C intercation heatmap from Juicer matrix

Usage:

    plotHiCMatrix.py <matrix> <output name (png)> <start> <end> <title in figure>

Example:

    plotHiCMatrix.py WT/intrachromosomal/25000/observed.KR.chr7.matrix.gz chr7/WT_chr7_25000000-31000000.png 25000000 31000000 WT

### plotInsulationScore.py
Plot insulation score from Juicer matrix

Usage:

     plotInsulationScore.py [-h] [--num4norm NUM4NORM] [--distance DISTANCE]
                                 [--sizex SIZEX] [--sizey SIZEY]
                                 matrix output resolution

### plotMultiScaleInsulationScore.py
Plot multi-scale insulation scores from Juicer matrix

Usage:

     plotMultiScaleInsulationScore.py [-h] [--num4norm NUM4NORM]
                                           [--sizex SIZEX] [--sizey SIZEY]
                                           matrix output resolution

### plotHiCfeature.py
Plot various feature (Compartment, Directionality Index, Insulation score, etc) values of multiple Hi-C samples

Usage:

     plotHiCfeature.py [-h] [--type TYPE] [--distance DISTANCE]
                         [-r RESOLUTION] [-s START] [-e END] [--multi]
                         [--compartment] [--di] [--dfr] [--vmax VMAX]
                         [--vmin VMIN] [-d VIZDISTANCEMAX] [--xsize XSIZE]
                         [input [input ...]] output chr

- Input should be "<sample directory>:<label>". Direcotory is generated by "Juicer.sh".
- type is defined by Juicer (KR/VC_SQRT)

Exammple:

     # Directionality Index
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.DI chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --di
     # PC1 for compartment
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.compartment chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --compartment
     # multiInsulationScore
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.MultiIS chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --multi
     # single InsulationScore
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.SingleIS chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000
     # DirectionalFreqRatio
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.DFR chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --dfr
     # DirectionalFreqRatio (right)
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.DFRright chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --dfr_right
     # DirectionalFreqRatio (left)
     plotHiCfeature.py Ctrl:Control CTCF:siCTCF chr9left.DFRleft chr9 --start 1000000 --end 38000000 --type VC_SQRT -d 5000000 --dfr_left

### drawTriangleMulti.py
Plot Interaction matrix from Juicer matrix

Usage:

     drawTriangleMulti.py [input [input ...]] output region --type $type        # linear scale
     drawTriangleMulti.py [input [input ...]] output region --type $type --log  # log scale

### drawTriangleRatioMulti.py
Plot Interaction ratio (from 2nd to the last samples divided by 1st sample).

Usage:

     drawTriangleRatioMulti.py [input [input ...]] output region --type $type    # logratio

###  DirectionalFreqRatio.py

Output  DirectionalFreqRatio as bedGraph

Usage:

     DirectionalFreqRatio.py [-h] [--dfr_right] [--dfr_left] input control output chr resolution

Example:

     DirectionalFreqRatio.py \
              Ctrl/matrix/intrachromosomal/25000/observed.VC_SQRT.chr21.matri x.gz \
              siCTCF/matrix/intrachromosomal/25000/observed.VC_SQRT.chr21.matrix.gz \
              CTCF.DFR.chr21 \
              chr21 \
              25000
